<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<title>MediaPipe Hands Debug Test</title>

<style>
body {
  margin: 0;
  background: black;
  color: white;
  font-family: monospace;
  overflow: hidden;
}

#startOverlay {
  position: fixed;
  inset: 0;
  background: black;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 20px;
  z-index: 10;
  cursor: pointer;
}

#camBox {
  position: fixed;
  inset: 0;
}

video {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transform: scaleX(-1); /* selfie mirror (visual only) */
}

canvas {
  position: absolute;
  inset: 0;
  pointer-events: none;
}
</style>
</head>
<body>

<div id="startOverlay">Tap to Start Camera ✋</div>

<div id="camBox">
  <video id="camView" autoplay playsinline muted></video>
  <canvas id="overlay"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

<script>
const video = document.getElementById("camView");
const overlay = document.getElementById("overlay");
const ctx = overlay.getContext("2d");

// Force known resolution (CRITICAL)
video.width = 640;
video.height = 480;

// MediaPipe Hands
const hands = new Hands({
  locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${f}`
});

hands.setOptions({
  maxNumHands: 1,
  modelComplexity: 0,
  minDetectionConfidence: 0.4,
  minTrackingConfidence: 0.4
});

hands.onResults(res => {
  const w = video.videoWidth || 640;
  const h = video.videoHeight || 480;
  overlay.width = w;
  overlay.height = h;

  ctx.clearRect(0, 0, w, h);
  ctx.font = "22px monospace";

  if (!res.multiHandLandmarks || res.multiHandLandmarks.length === 0) {
    ctx.fillStyle = "red";
    ctx.fillText("NO HAND DETECTED", 20, 40);
    return;
  }

  ctx.fillStyle = "lime";
  ctx.fillText("HAND DETECTED ✅", 20, 40);

  // Draw landmark points
  res.multiHandLandmarks[0].forEach(p => {
    ctx.beginPath();
    ctx.arc(p.x * w, p.y * h, 6, 0, Math.PI * 2);
    ctx.fill();
  });
});

let cam;

// Start camera ONLY after user interaction
document.getElementById("startOverlay").onclick = () => {
  document.getElementById("startOverlay").style.display = "none";

  cam = new Camera(video, {
    onFrame: async () => {
      await hands.send({ image: video });
    },
    width: 640,
    height: 480,
    facingMode: "user"
  });

  cam.start();
};
</script>

</body>
  </html>
